{{config(materialized='view')}}

WITH imd AS (
    SELECT *
    FROM {{ref("stg_imd")}}
)

SELECT 
LSOA_CODE,
DEP_INDEX,
MAX(CASE WHEN MEASUREMENT = 'Rank' THEN VALUE END) AS RANK,
MAX(CASE WHEN MEASUREMENT = 'Decile' THEN VALUE END) AS DECILE,
MAX(CASE WHEN MEASUREMENT = 'Score' THEN VALUE END) AS SCORE
FROM imd
GROUP BY 1, 2